<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢å‘å¸ƒå·¥å…· - YEYUbaka</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .tags-input,
        .categories-input {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag-item,
        .category-item {
            display: inline-flex;
            align-items: center;
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
        }

        .tag-item .remove,
        .category-item .remove {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .tag-item .remove:hover,
        .category-item .remove:hover {
            opacity: 0.8;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }

        .file-upload.dragover {
            background: #e8ebff;
            border-color: #764ba2;
        }

        .file-upload input {
            display: none;
        }

        .file-list {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-item {
            background: #e8ebff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item .remove {
            cursor: pointer;
            color: #d32f2f;
            font-weight: bold;
        }

        .preview-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .preview-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .actions {
            margin-top: 30px;
            text-align: center;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ åšå®¢å‘å¸ƒå·¥å…·</h1>
            <p>ä¸Šä¼  Markdown æ–‡ä»¶å’Œå›¾ç‰‡ï¼Œä¸€é”®å‘å¸ƒåˆ°åšå®¢</p>
        </div>

        <div class="content">
            <form id="publishForm">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="form-section">
                    <h2>ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="title">æ–‡ç« æ ‡é¢˜ *</label>
                            <input type="text" id="title" name="title" required placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label for="author">ä½œè€…</label>
                            <input type="text" id="author" name="author" value="YEYUbaka" placeholder="ä½œè€…åç§°">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description">æ–‡ç« æ‘˜è¦ *</label>
                        <textarea id="description" name="description" required placeholder="è¯·è¾“å…¥æ–‡ç« æ‘˜è¦ï¼Œç”¨äº SEO å’Œåˆ—è¡¨å±•ç¤ºï¼ˆå»ºè®® 150 å­—ä»¥å†…ï¼‰"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date">å‘å¸ƒæ—¥æœŸ *</label>
                            <input type="datetime-local" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="draft">å‘å¸ƒçŠ¶æ€</label>
                            <select id="draft" name="draft">
                                <option value="false">ç«‹å³å‘å¸ƒ</option>
                                <option value="true">ä¿å­˜ä¸ºè‰ç¨¿</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- åˆ†ç±»å’Œæ ‡ç­¾ -->
                <div class="form-section">
                    <h2>ğŸ·ï¸ åˆ†ç±»å’Œæ ‡ç­¾</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="categoryInput">åˆ†ç±»</label>
                            <input type="text" id="categoryInput" placeholder="è¾“å…¥åˆ†ç±»åæŒ‰å›è½¦æ·»åŠ ">
                            <div class="categories-input" id="categoriesList"></div>
                        </div>
                        <div class="form-group">
                            <label for="tagInput">æ ‡ç­¾</label>
                            <input type="text" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ ">
                            <div class="tags-input" id="tagsList"></div>
                        </div>
                    </div>
                </div>

                <!-- å°é¢å›¾ç‰‡ -->
                <div class="form-section">
                    <h2>ğŸ–¼ï¸ å°é¢å›¾ç‰‡</h2>
                    <div class="form-group">
                        <label for="coverImage">å°é¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                        <div class="file-upload" id="coverUpload">
                            <input type="file" id="coverImage" accept="image/*">
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å°é¢å›¾ç‰‡</p>
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼</p>
                        </div>
                        <div id="coverPreview" style="margin-top: 15px; display: none;">
                            <img id="coverPreviewImg" style="max-width: 300px; border-radius: 8px; border: 2px solid #e0e0e0;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="coverAlt">å›¾ç‰‡æè¿°</label>
                        <input type="text" id="coverAlt" placeholder="å°é¢å›¾ç‰‡çš„ alt æ–‡æœ¬">
                    </div>
                </div>

                <!-- Markdown æ–‡ä»¶ -->
                <div class="form-section">
                    <h2>ğŸ“„ Markdown æ–‡ä»¶</h2>
                    <div class="form-group">
                        <label for="markdownFile">ä¸Šä¼  Markdown æ–‡ä»¶ *</label>
                        <div class="file-upload" id="markdownUpload">
                            <input type="file" id="markdownFile" accept=".md,.markdown" required>
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼  Markdown æ–‡ä»¶</p>
                        </div>
                        <div id="markdownFileName" style="margin-top: 10px; color: #666;"></div>
                    </div>
                </div>

                <!-- æ–‡ç« å›¾ç‰‡ -->
                <div class="form-section">
                    <h2>ğŸ–¼ï¸ æ–‡ç« å›¾ç‰‡</h2>
                    <div class="form-group">
                        <label>ä¸Šä¼ æ–‡ç« ä¸­çš„å›¾ç‰‡ï¼ˆå¯é€‰ï¼Œæ”¯æŒå¤šå¼ ï¼‰</label>
                        <div class="file-upload" id="imagesUpload">
                            <input type="file" id="articleImages" multiple accept="image/*">
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯å¤šé€‰ï¼‰</p>
                        </div>
                        <div class="file-list" id="imagesList"></div>
                    </div>
                </div>

                <!-- å…¶ä»–è®¾ç½® -->
                <div class="form-section">
                    <h2>âš™ï¸ å…¶ä»–è®¾ç½®</h2>
                    <div class="form-row">
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="featured" name="featured">
                            <label for="featured">åœ¨é¦–é¡µæ¨è</label>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="showToc" name="showToc" checked>
                            <label for="showToc">æ˜¾ç¤ºç›®å½•</label>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="tocOpen" name="tocOpen">
                            <label for="tocOpen">ç›®å½•é»˜è®¤å±•å¼€</label>
                        </div>
                    </div>
                </div>

                <!-- è‡ªåŠ¨æ„å»ºé€‰é¡¹ï¼ˆæœåŠ¡å™¨ç¯å¢ƒï¼‰ -->
                <div class="form-section" id="autoBuildSection" style="display: none;">
                    <h2>âš™ï¸ è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²</h2>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="autoBuild" name="autoBuild">
                        <label for="autoBuild">å‘å¸ƒåè‡ªåŠ¨æ„å»ºåšå®¢å¹¶éƒ¨ç½²åˆ°ç½‘ç«™ï¼ˆéœ€è¦æœåŠ¡å™¨ç¯å¢ƒï¼‰</label>
                    </div>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        å¯ç”¨åï¼Œå‘å¸ƒæ–‡ç« å°†è‡ªåŠ¨æ‰§è¡Œ Hugo æ„å»ºå¹¶åŒæ­¥åˆ°ç½‘ç«™ç›®å½•ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚
                    </p>
                </div>

                <!-- é¢„è§ˆ -->
                <div class="preview-section">
                    <h2>ğŸ‘ï¸ é¢„è§ˆ</h2>
                    <div class="preview-content" id="previewContent">å¡«å†™è¡¨å•åï¼Œé¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="actions">
                    <button type="button" class="btn btn-secondary" onclick="updatePreview()">æ›´æ–°é¢„è§ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="downloadFiles()">ä¸‹è½½æ–‡ä»¶</button>
                    <button type="button" class="btn btn-success" onclick="publishPost()">ä¸€é”®å‘å¸ƒ</button>
                </div>

                <!-- çŠ¶æ€æ¶ˆæ¯ -->
                <div id="statusMessage" class="status-message"></div>
            </form>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let categories = [];
        let tags = [];
        let markdownContent = '';
        let coverImageFile = null;
        let articleImages = [];
        let markdownFile = null;

        // æ£€æµ‹ç¯å¢ƒå¹¶è®¾ç½® API åœ°å€
        function getApiUrl() {
            // å¦‚æœå½“å‰åŸŸåæ˜¯ yeyubaka.topï¼Œä½¿ç”¨æœåŠ¡å™¨ API
            if (window.location.hostname === 'yeyubaka.top' || window.location.hostname === 'www.yeyubaka.top') {
                return '/publisher/api';
            }
            // å¦åˆ™ä½¿ç”¨æœ¬åœ° API
            return 'http://localhost:3000/api';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ—¥æœŸä¸ºä»Šå¤©
            document.getElementById('date').value = new Date().toISOString().slice(0, 16);
            
            // æ£€æµ‹æ˜¯å¦ä¸ºæœåŠ¡å™¨ç¯å¢ƒï¼Œæ˜¾ç¤ºè‡ªåŠ¨æ„å»ºé€‰é¡¹
            const isServer = window.location.hostname === 'yeyubaka.top' || window.location.hostname === 'www.yeyubaka.top';
            if (isServer) {
                document.getElementById('autoBuildSection').style.display = 'block';
            }
            
            // æ·»åŠ æ–‡ä»¶ä¸Šä¼ åŒºåŸŸçš„ç‚¹å‡»äº‹ä»¶
            document.getElementById('coverUpload').addEventListener('click', function() {
                document.getElementById('coverImage').click();
            });
            
            document.getElementById('markdownUpload').addEventListener('click', function() {
                document.getElementById('markdownFile').click();
            });
            
            document.getElementById('imagesUpload').addEventListener('click', function() {
                document.getElementById('articleImages').click();
            });
        });

        // åˆ†ç±»è¾“å…¥
        document.getElementById('categoryInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const value = this.value.trim();
                if (value && !categories.includes(value)) {
                    categories.push(value);
                    updateCategoriesList();
                    this.value = '';
                }
            }
        });

        // æ ‡ç­¾è¾“å…¥
        document.getElementById('tagInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const value = this.value.trim();
                if (value && !tags.includes(value)) {
                    tags.push(value);
                    updateTagsList();
                    this.value = '';
                }
            }
        });

        function updateCategoriesList() {
            const list = document.getElementById('categoriesList');
            list.innerHTML = categories.map(cat => `
                <span class="category-item">
                    ${cat}
                    <span class="remove" onclick="removeCategory('${cat}')">Ã—</span>
                </span>
            `).join('');
        }

        function updateTagsList() {
            const list = document.getElementById('tagsList');
            list.innerHTML = tags.map(tag => `
                <span class="tag-item">
                    ${tag}
                    <span class="remove" onclick="removeTag('${tag}')">Ã—</span>
                </span>
            `).join('');
        }

        function removeCategory(cat) {
            categories = categories.filter(c => c !== cat);
            updateCategoriesList();
        }

        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTagsList();
        }

        // Markdown æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('markdownFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                markdownFile = file;
                document.getElementById('markdownFileName').textContent = `å·²é€‰æ‹©: ${file.name}`;
                const reader = new FileReader();
                reader.onload = function(e) {
                    markdownContent = e.target.result;
                    updatePreview();
                };
                reader.readAsText(file);
            }
        });

        // å°é¢å›¾ç‰‡ä¸Šä¼ 
        document.getElementById('coverImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                coverImageFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('coverPreviewImg').src = e.target.result;
                    document.getElementById('coverPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // æ–‡ç« å›¾ç‰‡ä¸Šä¼ 
        document.getElementById('articleImages').addEventListener('change', function(e) {
            Array.from(e.target.files).forEach(file => {
                if (!articleImages.find(img => img.name === file.name)) {
                    articleImages.push(file);
                }
            });
            updateImagesList();
        });

        function updateImagesList() {
            const list = document.getElementById('imagesList');
            list.innerHTML = articleImages.map((img, index) => `
                <div class="file-item">
                    <span>${img.name}</span>
                    <span class="remove" onclick="removeImage(${index})">Ã—</span>
                </div>
            `).join('');
        }

        function removeImage(index) {
            articleImages.splice(index, 1);
            updateImagesList();
        }

        // æ‹–æ‹½ä¸Šä¼ 
        ['coverUpload', 'markdownUpload', 'imagesUpload'].forEach(id => {
            const element = document.getElementById(id);
            element.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            element.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            element.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (id === 'markdownUpload') {
                    const mdFile = Array.from(files).find(f => f.name.endsWith('.md') || f.name.endsWith('.markdown'));
                    if (mdFile) {
                        document.getElementById('markdownFile').files = new FileList([mdFile]);
                        document.getElementById('markdownFile').dispatchEvent(new Event('change'));
                    }
                } else if (id === 'coverUpload') {
                    const imgFile = Array.from(files).find(f => f.type.startsWith('image/'));
                    if (imgFile) {
                        document.getElementById('coverImage').files = new FileList([imgFile]);
                        document.getElementById('coverImage').dispatchEvent(new Event('change'));
                    }
                } else if (id === 'imagesUpload') {
                    const imgFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
                    imgFiles.forEach(file => {
                        if (!articleImages.find(img => img.name === file.name)) {
                            articleImages.push(file);
                        }
                    });
                    updateImagesList();
                }
            });
        });

        // ç”Ÿæˆ Front Matter
        function generateFrontMatter() {
            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value || 'YEYUbaka';
            const description = document.getElementById('description').value;
            const date = new Date(document.getElementById('date').value);
            const draft = document.getElementById('draft').value === 'true';
            const featured = document.getElementById('featured').checked;
            const showToc = document.getElementById('showToc').checked;
            const tocOpen = document.getElementById('tocOpen').checked;
            const coverAlt = document.getElementById('coverAlt').value;

            const dateStr = date.toISOString().replace('Z', '+08:00');
            const lastmodStr = new Date().toISOString().replace('Z', '+08:00');

            let frontMatter = '---\n';
            frontMatter += `title: "${title}"\n`;
            frontMatter += `date: ${dateStr}\n`;
            frontMatter += `lastmod: ${lastmodStr}\n`;
            frontMatter += `draft: ${draft}\n`;
            frontMatter += `author: "${author}"\n`;
            frontMatter += `description: "${description}"\n`;

            if (tags.length > 0) {
                frontMatter += 'tags:\n';
                tags.forEach(tag => {
                    frontMatter += `  - ${tag}\n`;
                });
            }

            if (categories.length > 0) {
                frontMatter += 'categories:\n';
                categories.forEach(cat => {
                    frontMatter += `  - ${cat}\n`;
                });
            }

            if (coverImageFile) {
                const coverFileName = coverImageFile.name;
                frontMatter += 'cover:\n';
                frontMatter += `  image: "images/posts/${coverFileName}"\n`;
                frontMatter += `  alt: "${coverAlt || coverFileName}"\n`;
                frontMatter += `  caption: ""\n`;
                frontMatter += `  relative: true\n`;
            }

            frontMatter += `featured: ${featured}\n`;
            frontMatter += `showToc: ${showToc}\n`;
            frontMatter += `tocOpen: ${tocOpen}\n`;
            frontMatter += '---\n\n';

            return frontMatter;
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const frontMatter = generateFrontMatter();
            const preview = frontMatter + markdownContent;
            document.getElementById('previewContent').textContent = preview;
        }

        // ç”Ÿæˆæ–‡ä»¶å
        function generateFileName() {
            const title = document.getElementById('title').value;
            const date = new Date(document.getElementById('date').value);
            const dateStr = date.toISOString().slice(0, 10);
            const titleSlug = title
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim();
            return `${dateStr}-${titleSlug}.md`;
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFiles() {
            if (!markdownContent) {
                showMessage('è¯·å…ˆä¸Šä¼  Markdown æ–‡ä»¶', 'error');
                return;
            }

            const frontMatter = generateFrontMatter();
            const fullContent = frontMatter + markdownContent;
            const fileName = generateFileName();

            // ä¸‹è½½ Markdown æ–‡ä»¶
            const blob = new Blob([fullContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);

            // ä¸‹è½½å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
            if (coverImageFile) {
                downloadImage(coverImageFile, 'å°é¢å›¾ç‰‡');
            }
            articleImages.forEach((img, index) => {
                downloadImage(img, `æ–‡ç« å›¾ç‰‡${index + 1}`);
            });

            showMessage('æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼è¯·å°†æ–‡ä»¶å¤åˆ¶åˆ°åšå®¢ç›®å½•', 'success');
        }

        function downloadImage(file, label) {
            const url = URL.createObjectURL(file);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ä¸€é”®å‘å¸ƒï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
        async function publishPost() {
            if (!markdownContent) {
                showMessage('è¯·å…ˆä¸Šä¼  Markdown æ–‡ä»¶', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('author', document.getElementById('author').value || 'YEYUbaka');
            formData.append('description', document.getElementById('description').value);
            formData.append('date', document.getElementById('date').value);
            formData.append('draft', document.getElementById('draft').value);
            formData.append('featured', document.getElementById('featured').checked);
            formData.append('showToc', document.getElementById('showToc').checked);
            formData.append('tocOpen', document.getElementById('tocOpen').checked);
            formData.append('coverAlt', document.getElementById('coverAlt').value);
            formData.append('categories', JSON.stringify(categories));
            formData.append('tags', JSON.stringify(tags));
            formData.append('markdown', markdownContent);
            
            if (coverImageFile) {
                formData.append('coverImage', coverImageFile);
            }
            
            articleImages.forEach(img => {
                formData.append('articleImages', img);
            });

            // æ·»åŠ è‡ªåŠ¨æ„å»ºé€‰é¡¹
            const autoBuild = document.getElementById('autoBuild').checked;
            formData.append('autoBuild', autoBuild);

            try {
                const apiUrl = getApiUrl();
                const response = await fetch(`${apiUrl}/publish`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    let message = result.message || 'å‘å¸ƒæˆåŠŸï¼';
                    if (result.build) {
                        if (result.build.built && result.build.synced) {
                            message += ' åšå®¢å·²è‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²ã€‚';
                        } else if (result.build.built) {
                            message += ' åšå®¢å·²æ„å»ºï¼Œä½†åŒæ­¥å¤±è´¥ã€‚';
                        }
                    }
                    showMessage(message, 'success');
                } else {
                    showMessage(result.error || 'å‘å¸ƒå¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('æ— æ³•è¿æ¥åˆ°å‘å¸ƒæœåŠ¡å™¨ã€‚è¯·ä½¿ç”¨"ä¸‹è½½æ–‡ä»¶"åŠŸèƒ½ï¼Œç„¶åæ‰‹åŠ¨å¤åˆ¶åˆ°åšå®¢ç›®å½•ã€‚', 'error');
                console.error('å‘å¸ƒé”™è¯¯:', error);
            }
        }

        function showMessage(message, type) {
            const msgEl = document.getElementById('statusMessage');
            msgEl.textContent = message;
            msgEl.className = `status-message ${type}`;
            setTimeout(() => {
                msgEl.className = 'status-message';
            }, 5000);
        }

        // è¡¨å•å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°é¢„è§ˆ
        ['title', 'author', 'description', 'date', 'draft', 'featured', 'showToc', 'tocOpen', 'coverAlt'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('change', updatePreview);
                el.addEventListener('input', updatePreview);
            }
        });
    </script>
</body>
</html>

